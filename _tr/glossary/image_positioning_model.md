---
title: Модель позиционирования изображения
origin: https://wiki.panotools.org/Image_positioning_model
status: done
last_modified_at: 2022-12-08
---
Модель позиционирования изображения Panotools предполагает, что все изображения сняты с об­щей точки обзора.
Общая точка обзора — единственный способ избежать [параллакса][parallax] между соседними изображениями,
который может привести к не­ис­пра­ви­мым ошибкам [сшивки][stitching].  Эта точка определяется геометрией объектива
и обычно называется [точкой отсутствия параллакса][no_parallax_point].

При съем­ке панорамы камеру можно поворачивать вокруг этой точки под тре­мя углами: из сто­ро­ны в сто­ро­ну, вверх-вниз
и вокруг [оптической оси][optical_axis] (подобно рулевому колесу). Во всех продуктах Panotools для этих трех углов
используются названия *[«рысканье» (yaw)][yaw]*, *[«тангаж» (pitch)][pitch]* и *[«крен» (roll)][roll]* — частные
случаи [углов Эй­ле­ра][euler], также называемые [углами Тей­та-Брай­а­на][tait_bryan]. С тем же названием и значением
они используются для обоз­на­че­ния [главных осей самолета][aircraft][^air].

Чтобы учесть (небольшой) сдвиг камеры, эта модель была дополнена параметрами перевода TrX, TrY и TrZ, которые
описывают движение камеры в 3D (более подробное описание см. в ма­те­ри­а­ле [«Сшивка фотомозаики»][stitching_a_photo_mosaic]).

## Система координат

Изображения располагаются внутри виртуальной сферы независимо от ис­поль­зу­е­мой выходной [проекции][projection].
Центр результирующего холста всегда имеет рысканье и тангаж равные нулю. Положительные значения рысканья означают,
что кадр расположен справа, от­ри­ца­тель­ные — слева. Положительный тан­гаж — вверх, от­ри­ца­тель­ный — вниз. Положительные
значения крена означают, что изображение вращается по ча­со­вой стрелке, от­ри­ца­тель­ные — против часовой стрелки.
Диапазон рысканья и крена составляет от -180° до +180°, причем 180° и -180° означают одно и то же положение,
диапазон тангажа составляет от -90° ([надир][nadir]) до +90° ([зенит][zenith]). Нулевое рыс­канье — это вертикальная
линия, проходящая через центр холста, нулевой тан­гаж — экватор виртуальной выходной сферы, горизонтальная линия,
проходящая через центр холста. Нулевой крен означает, что камера была установлена строго горизонтально (для кад­ров
с аль­бом­ной ориентацией) или строго вертикально (для кад­ров с пор­т­рет­ной ориентацией).

## Исходные изображения

Значения рысканья, тангажа и крена исходного изображения всегда относятся к [оп­ти­чес­кой оси][optical_axis]. Позиционирование
изображения с па­ра­мет­ра­ми рысканья и тангажа, равными нулю, значит, что его оптическая ось находится в цен­т­ре холста.
Обратите внимание, что фактический центр исходного изображения не обязательно должен совпадать с оптической осью
из-за [кор­рек­ции сдвига объектива][lens_shift_correction]. Следовательно границы изображения с ну­ле­вы­ми рысканьем
и тангажем не обя­за­тель­но центрировать на хол­с­те результата. Другие [параметры коррекции объектива][lens_correction_params]
не вли­я­ют на по­зи­ци­о­ни­ро­ва­ние изображения, так как выполняются симметрично относительно оптической оси.

## Оптимизация

Относительные позиции кадров определяются по [кон­т­роль­ным точкам][control_points] на эта­пе [оптимизации][optimization] выравнивания.
Точно так же, как вам нужно по край­ней мере две иголки, чтобы прикрепить напечатанное изображение к сте­не, чтобы оно не могло
двигаться, вам нужно по край­ней мере две пары контрольных точек на па­ру изображений, чтобы зафиксировать их относительное положение.
Однако расстояние между контрольными точками может быть разным на этих изображениях. Задача оп­ти­ми­за­то­ра — найти наилучшее приближение.
См. пост [Гельмута Дерша][helmut_dersch]: [«Количество контрольных точек»][post]. Для оп­ти­ми­за­ции [искажений объектива][lens_correction_params]
может потребоваться больше контрольных точек.


[^air]: Именно из са­мо­лет­ной терминологии был взят перевод данных терминов, для од­но­знач­нос­ти. Возможно, это не луч­ший
        вариант.

[parallax]: {% link _tr/glossary/parallax.md %}
[stitching]: {% link _tr/glossary/stitching.md %}
[no_parallax_point]: {% link _tr/glossary/no_parallax_point.md %}
[optical_axis]: {% link _tr/glossary/optical_axis.md %}
[yaw]: {% link _tr/glossary/yaw.md %}
[pitch]: {% link _tr/glossary/pitch.md %}
[roll]: {% link _tr/glossary/roll.md %}
[euler]: http://www.wikipedia.org/wiki/Euler_angles
[tait_bryan]: http://www.wikipedia.org/wiki/Euler_angles#Tait.E2.80.93Bryan_angles
[aircraft]: http://www.wikipedia.org/wiki/Aircraft_principal_axes
[stitching_a_photo_mosaic]: {% link _tr/tutorials/stitching_a_photo_mosaic.md %}
[projection]: {% link _tr/projections/index.md %}
[nadir]: {% link _tr/glossary/nadir.md %}
[zenith]: {% link _tr/glossary/zenith.md %}
[lens_shift_correction]: {% link _tr/glossary/lens_correction_model.md %}#lens_or_image_shift_d_and_e_parameters
[lens_correction_params]: {% link _tr/glossary/lens_correction_model.md %}
[control_points]: {% link _tr/glossary/control_points.md %}
[optimization]: {% link _tr/glossary/optimization.md %}
[helmut_dersch]: {% link _tr/glossary/helmut_dersch.md %}
[post]: http://www.panotools.org/mailarchive/msg/5542
