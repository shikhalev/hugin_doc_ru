---
title: Полностью 16-битный процесс
origin: https://wiki.panotools.org/Full_16_bit_workflow
status: done
last_modified_at: 2022-11-22
---
Одной из самых больших проблем при создании панорам является [динамический диапазон][dynamic_range]. Чтобы сохранить
как максимальное количество уровней, так и максимальный динамический диапазон, рекомендуется использовать 16-битный
рабочий процесс. 16 бит здесь относится к разрядности одного канала. Однако в некоторых приложениях и руководствах
используется термин «48 бит» или «64 бит», который относится к полной битовой глубине для всех каналов и по существу
означает то же самое.

## Требования

Это руководство предназначено только для опытных пользователей. Предполагается, что вы знакомы со съемкой, сшиванием,
смешиванием 8-битных изображений, а также с базовыми и расширенными методами редактирования в Photoshop, такими как
использование слоев изображения, корректирующих слоев и масок.

### Источник изображения

Чтобы использовать 16-битный рабочий процесс, вам нужна камера, способная сохранять файлы [RAW][raw], или сканер плюс
приложение, позволяющие сохранять 16-битные файлы. См. [«Извлечение динамического диапазона RAW»][raw_extraction], чтобы
узнать, как извлечь полный динамический диапазон из файла RAW в один документ с 16 битами на канал.

### Программное обеспечение

Последняя версия библиотеки [`pano12`][pano12] поддерживает 16 бит, так же, как и основные [GUI-фронтенды][gui_fronts].
Если вы хотите использовать [`autopano`][autopano], вам может понадобиться инструмент для пакетного преобразования изображений
в 8-битные (например, IrfanView), поскольку в `autopano` в настоящее время есть баг, который вызывает сообщение об ошибке
для некоторых типов 16-битных [TIFF][tiff]. Некоторые камеры (например, Nikon D70) сохраняют файл [JPEG][jpeg] вместе с файлом RAW.
Вы можете использовать этот файл JPEG для использования с `autopano`. После создания контрольных точек замените JPEG
на его 16-битный вариант.

Если вы хотите отредактировать результат многослойного сшивания, вам понадобится Adobe [Photoshop][photoshop] CS или выше.
В этом нет необходимости, если вы используете [`enblend`][enblend] для смешивания изображений.

## Съемка панорамы

### Использование цифровой камеры

Чтобы получить максимальный [динамический диапазон][dynamic_range] с помощью цифровой камеры, используйте экспозицию для самых
ярких объектов, в которых вы хотите получить детали. В освещенном солнцем пейзаже это обычно облака, но также может быть и белое
здание. Цифровые камеры отсекают света, но не тени. Проверьте гистограмму, чтобы увидеть, является ли отсечение проблемой.
Хорошую статью о правильной экспозиции с цифровыми изображениями можно найти
по адресу <http://luminous-landscape.com/tutorials/expose-right.shtml>.

Съемка в формате [RAW][raw] позволяет позже создавать из этих файлов 16-битные файлы [TIFF][tiff] с точно отрегулированными
экспозицией и балансом белого или даже с другими настройками экспозиции и баланса белого, чтобы пересобрать изображения более
благоприятным образом, например, с другим балансом белого для панорамных окон.

В плагине Adobe RAW должна быть возможность найти такие настройки, чтобы извлечь хотя бы большую часть доступного
[динамического диапазона][dynamic_range]. Попробуйте найти такое значение экспозиции, которое не обрезает света сильнее, чем
обрезала камера, и установите «Тени», «Яркость» и «Контрастность» на самые низкие значения. Это, вероятно, сохранит большую
часть динамического диапазона.

Если вы не используете Windows или Mac OS или просто хотите использовать инструмент командной строки, способный извлекать
полный динамический диапазон, всегда есть [`dcraw`][dcraw].

### Использование пленки

#### Съемка

С цветной негативной пленкой используйте экспонирование для самой темной тени, в которой вы хотите получить детали.
Рекомендуется штатив, так как время экспонирования может быть очень долгим, особенно при остановке. Я использую стандартную
экспозицию 1/15s при f/16 на ярком солнечном свете с Fuji Reala. Цветная негативная пленка обрезает тени, но не света. Будет
хорошей идеей сделать дополнительное изображение, содержащее какую-нибудь цветовую диаграмму или, по крайней мере, серую карту
плюс белый лист бумаги и что-то полностью черное. Это поможет позже настроить баланс белого.

#### Сканирование

Избегайте клиппинга при сканировании. Отключите все автоматические функции в программном обеспечении для сканирования, которые
влияют на баланс белого или экспозицию. Сохраняйте как 16-битный [TIFF][tiff] (иногда называемый 48-битным [TIFF][tiff]).
Поэкспериментируйте со своим программным обеспечением для сканирования.

С Vuescan используйте расширенный рабочий процесс (см. руководство). Установите цветовой баланс на «Нет» на вкладке «Цвет».
Не беспокойтесь о том, что результат будет тусклым и с цветовым оттенком — в готовой сшитой панораме можно исправить все что угодно.
Сохранить как «48-битный [TIFF][tiff]».

## Сшивка

Если вы хотите использовать [`autopano`][autopano], рекомендуется работать с 8-битными копиями ваших изображений для создания
контрольных точек. `autopano` должен работать с 16-битными изображениями, но в настоящее время отказывается работать с некоторыми
типами. Как только вы закончите с `autopano`, вы можете вернуться к 16-битным оригиналам.

Старые версии [PTGui][ptgui] автоматически деградировали изображения до 8 бит, если вы выбирали рамку обрезки за пределами
изображения или использовали фильтр.

Самые последние версии PTGui имеют собственный поиск контрольных точек и сшиватель, оба из которых очень хорошо работают
с 16-битными изображениями. Если вы выберете сшиватель PTGui, вы можете установить битовую глубину 8 или 16 бит для выходных
форматов, которые его поддерживают.

## Смешивание

По сути, есть три[^three] возможных способа смешивания изображений:

- Позвольте panotools делать все, что угодно, выбрав любой формат вывода изображения, такой как [TIFF][tiff], [JPEG][jpeg] или [PSD][psd].
- Вывод нескольких файлов [TIFF][tiff] и их смешивание вручную в графическом редакторе с использованием слоев.
  16-битные слои в настоящее время обрабатываются Adobe [Photoshop][photoshop], [krita][krita] или [GIMP][gimp].
- Использование [`enblend`][enblend]
- Использование [SmartBlend][smartblend]
- Использование внутреннего блендера [PTGui][ptgui] (только последние версии).

### Enblend

[`enblend`][enblend] хорошо обрабатывает 16-битные изображения. Сделайте то, что вы делали и раньше, используя `enblend`,
и вы получите смешанный 16-битный [TIFF][tiff]. Однако имейте в виду, что в изображение добавляется дополнительный [альфа-канал][alpha_channel].

### SmartBlend

[SmartBlend][smartblend] может работать с 16-битными изображениями, начиная с версии 1.2.2. Он работает точно так же, как `enblend`,
с тем большим отличием, что он пытается удалить [«призраков»][ghosting].

### Photoshop CS

#### Импорт изображений

В качестве вывода выберите [TIFF][tiff] с множественными изображениями как с растушевкой (TIFF_mask) так и без (TIFF_m). Используйте действие
«Импортировать файлы TIFF с [альфа-каналом][alpha_channel] в маскированные слои», которое можно загрузить с <http://www.erik-krause.de/ttt>,
чтобы собрать отдельные изображения (обычно с именами `‹yourimage›0000.tif`, `‹yourimage›0001.tif` и т.д.) в многослойный документ Photoshop.

#### Коррекция цветов

Если вы ранее снимали серую карту, загрузите это изображение как отдельный файл и поместите корректирующий слой уровней выше.
Используйте серую пипетку, чтобы получить нейтральные средние тона, но не используйте белую или черную пипетку, так как они
могут вызвать клиппинг.

Откройте информационную палитру. Установите точку выборки цвета (в среднем 5x5) для деталей черно-белого изображения и отрегулируйте
входные точки белого и черного для цветовых каналов вручную, чтобы получить одинаковые значения цвета для всех каналов. Часто
проверяйте значения RGB для черного, белого и серого образцов.

Попытайтесь получить минимальное значение общего цвета для точки белого (не изменяя канал с наибольшим значением) и максимальное
значение общего цвета для точки черного (не изменяя канал с наименьшим значением). Скорее всего, вам придется повторять эти шаги
до тех пор, пока вы не получите нейтральные черный, белый и серый, так как любая корректировка влияет на остальные.

Когда вы закончите, перетащите корректирующий слой из палитры слоев на панораму поверх всех остальных слоев. Если вы использовали
серый клин, вы можете сделать еще более точную настройку, используя кривые вместо уровней и настраивая несколько оттенков серого,
чтобы они были нейтральными.

Если вы не снимали серую карту, просто поместите корректирующий слой уровней или кривых поверх слоев изображения и отрегулируйте
цвета, чтобы они выглядели естественно.

Используйте дополнительные корректирующие слои для настройки контрастности и/или яркости. Может быть хорошей идеей использовать
S-образную кривую, чтобы увеличить контраст средних тонов. Сохраните документ перед сведением, чтобы иметь возможность исправить
его без потери уровней.

После этого отредактируйте маски отдельных слоев, чтобы избежать видимых швов, и, в конечном итоге, используйте дополнительные
корректирующие слои, сгруппированные с отдельными слоями изображения, чтобы настроить различия в цвете или яркости.

Если вы хотите, чтобы изображение выглядело более четким, сведите его к фону и используйте [нерезкую маску][sharpening] с порогом 0,
размером от 20% до 50% и радиусом от 70 до 250 пикселей (в зависимости от размера изображения). Перед этим шагом рекомендуется уменьшить
размер вывода до предполагаемого, так как это очень медленно работает с большими изображениями.

Если в тенях все еще скрыто много деталей или вас не устраивает контрастность, вы можете попробовать более сложные операторы
[отображения тонов][tone_mapping], например, один из тех, которые сравниваются при [сжатии HDR][hdr_compression], которые также работают
с 16-битными изображениями.

## Исправления

### Извлечение видов

Извлечение видов[^view] для «заклеивания» штатива, каких-то дыр или несоответствий в зените и проч., — может составлять некоторую проблему,
если вы хотите все делать в чистом 16-битном формате. Самая удобная возможность — [PTEditor][pteditor] — читает 16-битные [TIFF][tiff],
но записывает только 8-битные.

Единственная возможность выполнить задачу в 16-битной версии — это либо использовать [PTStitcher][ptstitcher] (с одним
из [GUI-интерфейсов][gui_frontends] или со сценарием), либо совместимые с [Photoshop][photoshop] [плагины Panorama Tools][panotools_plugins]
в 16-битной версии, предоставленные [Томасом Ниманном][thomas].

Различные возможности описаны в разделе [«Извлечение и вставка прямолинейных видов»][rect_views].

### Вставка «колпачков штатива»

Еще один способ закрыть штатив — вставить какое-нибудь другое изображение, например, логотип или зеркальный шар.
Это не должно быть проблемой для 16-битной версии, если это делается либо с помощью 16-битных плагинов (как упоминалось выше),
либо с помощью [PTStitcher][ptstitcher]. Многие возможности описаны в [дополнительных материалах][tripod_caps].


[^three]: В оригинале так и написано: «there are three possible ways...» — *прим. перев.*

[^view]: Тут есть проблемы с терминологией, «вид» («view») очень уж общее понятие. Речь идет о кусках изображения, которые с одной стороны являются сплошными кусками, с другой — не соответствуют ни исходным кадрам, ни даже их фрагментам, поскольку могут состоять из разных частей разных исходных кадров, к тому же с учетом слияния разных экспозиций и т.д. — *прим. перев.*

[dynamic_range]: {% link _tr/glossary/dynamic_range.md %}
[raw]: {% link _tr/glossary/raw.md %}
[raw_extraction]: {% link _tr/tutorials/raw_dynamic_range_extraction.md %}
[pano12]: {% link _tr/panotools/pano12.md %}
[gui_fronts]: {% link _tr/panotools/gui_frontends.md %}
[autopano]: {% link _tr/tools/autopano.md %}
[tiff]: {% link _tr/glossary/tiff.md %}
[jpeg]: {% link _tr/glossary/jpeg.md %}
[photoshop]: {% link _tr/glossary/photoshop.md %}
[enblend]: {% link _tr/tools/enblend.md %}
[dcraw]: {% link _tr/tools/dcraw.md %}
[ptgui]: {% link _tr/panotools/ptgui.md %}
[psd]: {% link _tr/glossary/psd.md %}
[krita]: {% link _tr/glossary/krita.md %}
[gimp]: {% link _tr/glossary/gimp.md %}
[smartblend]: {% link _tr/panotools/smartblend.md %}
[alpha_channel]: {% link _tr/glossary/alpha_channel.md %}
[ghosting]: {% link _tr/glossary/ghosting.md %}
[sharpening]: {% link _tr/glossary/sharpening.md %}
[tone_mapping]: {% link _tr/glossary/tone_mapping.md %}
[hdr_compression]: {% link _tr/glossary/hdr_compression.md %}
[pteditor]: {% link _tr/panotools/pteditor.md %}
[ptstitcher]: {% link _tr/panotools/ptstitcher.md %}
[gui_frontends]: {% link _tr/panotools/gui_frontends.md %}
[panotools_plugins]: {% link _tr/panotools/plugins.md %}
[thomas]: http://epaperpress.com/ptplugins/index.html
[rect_views]: {% link _tr/tutorials/extract_and_insert_rectilinear_views.md %}
[tripod_caps]: {% link _tr/tutorials/index.md %}#tripod_caps
